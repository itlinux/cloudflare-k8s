= Steps to deploy Cloudflare on Kubernetes

once the k8s is up and running follow the followings:
. login to cloudflare using the cli 

.login
----
cloudflared login
----

.create the tunnel using cloudflared 
----
cloudflared tunnel create k8s
----

.check your tunnel
----
cloudflared tunnel list
----

.output 
----
[root@rocky-tf-22 ~]# cloudflared tunnel list
071d2411-9f29-4f6e-94d6-c0ca1179587c k8s    2026-01-27T18:55:06Z 1xlax08, 1xlax10, 2xslc01
----

.create the secret for cloudflared
----
kubectl create secret generic cloudflared-credentials --from-file=credentials.json=.cloudflared/071d2411-9f29-4f6e-94d6-c0ca1179587c.json
----

.check k8s secret
----
kubectl get secret cloudflared-credentials -o yaml
----


.output
----
apiVersion: v1
data:
  credentials.json: yyJBY2NvdW50VGFnIjoiMzJjZGNiMGQ3YWNiZjczYmRkMWUxOTRmZTZjOTUxZTYiLCJUdW5uZWxTZWNyZXQiOiJHVnFhZVFtY2ltSXFsSmFkeTltZ1dOSVIrTWcrT3Nucmo5SWZTZUVGRVRZPSIsIlR1bm5lbElEIjoiMDcxZDI0MTEtOWYyOS00ZjZlLTk0ZDYtYzBjYTExNzk1ODdjIiwiRW5kcG9pbnQiOiIifQ==
kind: Secret
metadata:
  creationTimestamp: "2026-01-27T19:12:04Z"
  name: cloudflared-credentials
  namespace: default
  resourceVersion: "21734"
  uid: 21df4e76-71ab-41d3-8785-df5601f9a880
type: Opaque
----

Mkke sure the name matches otherwise you will need to edit the cloudflared file 

Apply the cloudlflare manifest

.cloudflare manifest
----
kubectl apply -f cloudflared.yaml
----

.Check the status of the pod
----
kubectl get pod
NAME                           READY   STATUS    RESTARTS   AGE
cloudflared-7f998bd767-jpj88   1/1     Running   0          125m
----


Also check cloudflared logs 
----
kubectl logs cloudflared-7f998bd767-jpj88
2026-01-27T20:11:49Z INF Starting tunnel tunnelID=071d2411-9f29-4f6e-94d6-c0ca1179587c
2026-01-27T20:11:49Z INF Version 2026.1.2 (Checksum 67204c583ad3b6e86a696b67af67ccbb4e28625b1e52df0e6873e29511aebb76)
2026-01-27T20:11:49Z INF GOOS: linux, GOVersion: go1.24.11, GoArch: amd64
2026-01-27T20:11:49Z INF Settings: map[config:/etc/cloudflared/config.yaml cred-file:/etc/cloudflared/creds/credentials.json credentials-file:/etc/cloudflared/creds/credentials.json metrics:0.0.0.0:2000 no-autoupdate:true]
2026-01-27T20:11:49Z INF Generated Connector ID: 860f5022-c543-49cb-8bda-49c3de23f34e
2026-01-27T20:11:49Z INF Initial protocol quic
2026-01-27T20:11:49Z INF ICMP proxy will use 10.42.0.26 as source for IPv4
2026-01-27T20:11:49Z INF ICMP proxy will use fe80::cf1:efff:fe2e:41a7 in zone eth0 as source for IPv6
2026-01-27T20:11:49Z INF ICMP proxy will use 10.42.0.26 as source for IPv4
2026-01-27T20:11:49Z INF ICMP proxy will use fe80::cf1:efff:fe2e:41a7 in zone eth0 as source for IPv6
2026-01-27T20:11:49Z INF Starting metrics server on [::]:2000/metrics
2026-01-27T20:11:49Z INF Tunnel connection curve preferences: [X25519MLKEM768 CurveP256] connIndex=0 event=0 ip=198.41.192.227
2026/01/27 20:11:49 failed to sufficiently increase receive buffer size (was: 208 kiB, wanted: 7168 kiB, got: 416 kiB). See https://github.com/quic-go/quic-go/wiki/UDP-Buffer-Sizes for details.
----




