= Steps to deploy Cloudflare on Kubernetes

once the k8s is up and running follow the followings:
. login to cloudflare using the cli 

.login
----
cloudflared login
----

.create the tunnel using cloudflared 
----
cloudflared tunnel create k8s
----

.check your tunnel
----
cloudflared tunnel list
----

.output 
----
[root@rocky-tf-22 ~]# cloudflared tunnel list
071d2411-9f29-4f6e-94d6-c0ca1179587c k8s    2026-01-27T18:55:06Z 1xlax08, 1xlax10, 2xslc01
----

.create the secret for cloudflared
----
kubectl create secret generic cloudflared-credentials --from-file=credentials.json=.cloudflared/071d2411-9f29-4f6e-94d6-c0ca1179587c.json
----

.check k8s secret
----
kubectl get secret cloudflared-credentials -o yaml
----


.output
----
apiVersion: v1
data:
  credentials.json: yyJBY2NvdW50VGFnIjoiMzJjZGNiMGQ3YWNiZjczYmRkMWUxOTRmZTZjOTUxZTYiLCJUdW5uZWxTZWNyZXQiOiJHVnFhZVFtY2ltSXFsSmFkeTltZ1dOSVIrTWcrT3Nucmo5SWZTZUVGRVRZPSIsIlR1bm5lbElEIjoiMDcxZDI0MTEtOWYyOS00ZjZlLTk0ZDYtYzBjYTExNzk1ODdjIiwiRW5kcG9pbnQiOiIifQ==
kind: Secret
metadata:
  creationTimestamp: "2026-01-27T19:12:04Z"
  name: cloudflared-credentials
  namespace: default
  resourceVersion: "21734"
  uid: 21df4e76-71ab-41d3-8785-df5601f9a880
type: Opaque
----

Mkke sure the name matches otherwise you will need to edit the cloudflared file 

Apply the cloudlflare manifest

.cloudflare manifest
----
kubectl apply -f cloudflared.yaml
----

.Check the status of the pod
----
kubectl get pod
NAME                           READY   STATUS    RESTARTS   AGE
cloudflared-7f998bd767-jpj88   1/1     Running   0          125m
----


Also check cloudflared logs 
----
kubectl logs cloudflared-7f998bd767-jpj88
2026-01-29T08:18:53Z INF Retrying connection in up to 1s connIndex=0 event=0 ip=198.41.192.107
2026-01-29T08:18:53Z WRN Connection terminated error="datagram manager encountered a failure while serving" connIndex=1
2026-01-29T08:18:54Z ERR failed to accept incoming stream requests error="failed to accept QUIC stream: timeout: no recent network activity" connIndex=2 event=0 ip=198.41.200.63
2026-01-29T08:18:54Z ERR failed to run the datagram handler error="timeout: no recent network activity" connIndex=2 event=0 ip=198.41.200.63
2026-01-29T08:18:54Z ERR failed to serve tunnel connection error="accept stream listener encountered a failure while serving" connIndex=2 event=0 ip=198.41.200.63
2026-01-29T08:18:54Z ERR Serve tunnel error error="accept stream listener encountered a failure while serving" connIndex=2 event=0 ip=198.41.200.63
2026-01-29T08:18:54Z INF Retrying connection in up to 1s connIndex=2 event=0 ip=198.41.200.63
2026-01-29T08:18:55Z INF Tunnel connection curve preferences: [X25519MLKEM768 CurveP256] connIndex=0 event=0 ip=198.41.192.107
2026-01-29T08:18:55Z INF Registered tunnel connection connIndex=0 connection=a54959ee-d749-485c-b10f-dd3777945e82 event=0 ip=198.41.192.107 location=den03 protocol=quic
----




